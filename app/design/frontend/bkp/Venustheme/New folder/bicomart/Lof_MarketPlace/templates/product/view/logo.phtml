<?php
/**
 * Landofcoder
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Landofcoder.com license that is
 * available through the world-wide-web at this URL:
 * https://landofcoder.com/terms
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category   Landofcoder
 * @package    Lof_MarketPlace
 * @copyright  Copyright (c) 2021 Landofcoder (https://www.landofcoder.com/)
 * @license    https://landofcoder.com/terms
 */

$sellerCollection = $this->getSellerCollection();

$data = $this->helper('Lof\MarketPlace\Helper\Data');
$currPageUrl = $data->getCurrentUrls();
//$seller_layout_listing = $data->getConfig("product_view_page/seller_layout_listing");
$show_seller_text = $data->getConfig("product_view_page/show_seller_text");
$show_seller_image = $data->getConfig("product_view_page/show_seller_image");
$show_seller_name = $data->getConfig("product_view_page/show_seller_name");
$show_seller_address = $data->getConfig("product_view_page/show_seller_address");
$show_seller_sale = $data->getConfig("product_view_page/show_seller_sale");
$show_seller_phone = $data->getConfig("product_view_page/show_seller_phone");
$show_seller_contact = $data->getConfig("product_view_page/show_seller_contact");
$text_contact = $data->getConfig("product_view_page/text_contact");
$formActionUrl = $this->getUrl('lofmarketplace/seller/savemessage');
$href = '#';
?>
<?php if ($sellerCollection && $sellerCollection->count()) {
    $sellerId = $sellerCollection->getFirstItem()->getData('seller_id');  ?>
    <?php
    $total = $sellerCollection->count();
    ?>
    <div class="sold-by bg-gray p-4 rounded">
    <div class="row align-items-center justify-content-between">
    <?php
    foreach ($sellerCollection as $_seller): 
    ?>
        <div class="seller-profile-container">
            <div class="m-0 -color-light"><?= __("Seller");?></div>
            <div class="seller-image col-xs-3">
                <?php if ($show_seller_image): ?>
                <a href="<?= $_seller->getUrl(); ?>" title="<?= $_seller->getName(); ?>">
                <img src="<?= $_seller->getThumbnailUrl(); ?>" alt="<?= $_seller->getName(); ?>"/></a>
                <?php endif; ?>
            </div>
            <div class="col-xs-9 seller-description">
                <?php if ($show_seller_name): ?>
                <h3 class="seller_title">
                    <a href="<?= $_seller->getUrl(); ?>" title="<?= $_seller->getName(); ?>"><?= $_seller->getName(); ?></a>
                </h3>
                <?php endif; ?>
                  <?php if ($_seller->getVerifyStatus() == "1"): ?>
                    <div class="seller-verify"><i class="mkpl-verify"></i><span><?= __('Verified')?></span></div>
                <?php endif;?>
                <?php if ($show_seller_text) { ?>
                    <span class="seller-headline"><?= $_seller->getShopTitle();?> </span>
                <?php } ?>
                <?php if ($show_seller_address) { ?>
                    <p class="seller-info"><span class="seller-address"><i class="fa fa-map-marker"></i><?= $_seller->getAddress();?>, <?= $_seller->getCountry();?></span></p>
                <?php } ?>
                <?php if ($show_seller_sale) { ?>
                <p class="seller-info">
                    <span class="seller-sales-count">
                        <i class="fa fa-shopping-cart"></i>
                        <?php if ($this->getTotalSales() >1) {
                            echo $this->getTotalSales().__(" Sales");
                        } else {
                            echo $this->getTotalSales().__(" Sale");
                        } ?>
                    </span>
                    <span class="seller-joined-date"><i class="fa fa-calendar"></i><?= __("Joined since ").$this->formatDate($_seller->getCreationTime(), \IntlDateFormatter::MEDIUM);?></span>
                </p>
                <?php } ?>
                <?php if ($show_seller_phone) { ?>
                <p class="seller-info">
                    <span class="seller-phone"><i class="fa fa-phone"></i><?= $_seller->getContactNumber();?></span>
                </p>
                <?php } ?>
                <?php if ($show_seller_contact) { ?>
                <div class="seller-info message-contact">
                    <a class="btn btn-brand btn--secondary btn-outline-brand  btn-sm" id="seller-contact" href="<?= $href;?>"><i class="fa fa-envelope-o"></i><?= $text_contact;?></a>
                </div>
                <?php } ?>
            </div>
        </div>
    <?php
    endforeach;
    ?>
    </div>
    </div>
    <?php if ($data->isLoggedIn()) { ?>
    <div class="contact-seller" id="contact-seller" style="display: none;">
        <form class="form contact" action="<?= $formActionUrl;?>" id="contact-form" method="post" data-hasrequired="<?php /* @escapeNotVerified */ echo __('* Required Fields') ?>" data-mage-init='{"validation":{}}'>
            <fieldset class="fieldset">
                <legend class="legend"><span><?php /* @escapeNotVerified */ echo $text_contact; ?></span></legend><br />
                <input name="sender_name" type="hidden" value="<?= $data->getCustomerName(); ?>" />
                <input name="sender_email" type="hidden" value="<?= $data->getCustomerEmail(); ?>" />
                <input name="sender_id" type="hidden" value="<?= $data->getCustomerId(); ?>" />
                <input name="owner_id" type="hidden" value="<?= $sellerId; ?>" />
                <div class="field name required">
                    <label class="label" for="subject"><span><?php /* @escapeNotVerified */ echo __('Subject') ?></span></label>
                    <div class="control">
                        <input name="subject" id="subject" title="<?php /* @escapeNotVerified */ echo __('Subject') ?>" class="input-text" type="text" data-validate="{required:true}"/>
                    </div>
                </div>
                <div class="field description required">
                    <label class="label" for="description"><span><?php /* @escapeNotVerified */ echo __('What’s on your mind?') ?></span></label>
                    <div class="control">
                        <textarea name="description" id="description" title="<?php /* @escapeNotVerified */ echo __('What’s on your mind?') ?>" class="input-text" cols="5" rows="3" data-validate="{required:true}"></textarea>
                    </div>
                </div>

            </fieldset>
            <div class="actions-toolbar">
                <div class="primary">
                    <input type="hidden" name="currUrl" id="currUrl" value="<?= $currPageUrl; ?>" />
                    <button type="submit" title="<?php /* @escapeNotVerified */ echo __('Submit') ?>" class="action submit primary">
                        <span><?php /* @escapeNotVerified */ echo __('Submit') ?></span>
                    </button>
                </div>
            </div>
        </form>
    </div>
    <?php } else { ?>
    <div class="contact-seller" id="contact-seller" style="display: none;">
        <form class="form contact" action="<?= $formActionUrl;?>" id="contact-form" method="post" data-hasrequired="<?php /* @escapeNotVerified */ echo __('* Required Fields') ?>" data-mage-init='{"validation":{}}'>
            <fieldset class="fieldset">
                <legend class="legend"><span><?php /* @escapeNotVerified */ echo $text_contact; ?></span></legend><br />
                <input name="owner_id" type="hidden" value="<?= $sellerId; ?>" />
                <div class="field name required">
                    <label class="label" for="sender_name"><span><?php /* @escapeNotVerified */ echo __('Customer Name') ?></span></label>
                    <div class="control">
                        <input name="sender_name" id="sender_name" title="<?php /* @escapeNotVerified */ echo __('Customer Name') ?>" class="input-text" type="text" data-validate="{required:true}"/>
                    </div>
                </div>
                <div class="field name required">
                    <label class="label" for="sender_email"><span><?php /* @escapeNotVerified */ echo __('Customer Email') ?></span></label>
                    <div class="control">
                        <input name="sender_email" id="sender_email" title="<?php /* @escapeNotVerified */ echo __('Customer Email') ?>" class="input-text" type="text" data-validate="{required:true}"/>
                    </div>
                </div>
                <div class="field name required">
                    <label class="label" for="subject"><span><?php /* @escapeNotVerified */ echo __('Subject') ?></span></label>
                    <div class="control">
                        <input name="subject" id="subject" title="<?php /* @escapeNotVerified */ echo __('Subject') ?>" class="input-text" type="text" data-validate="{required:true}"/>
                    </div>
                </div>
                <div class="field description required">
                    <label class="label" for="description"><span><?php /* @escapeNotVerified */ echo __('What’s on your mind?') ?></span></label>
                    <div class="control">
                        <textarea name="description" id="description" title="<?php /* @escapeNotVerified */ echo __('What’s on your mind?') ?>" class="input-text" cols="5" rows="3" data-validate="{required:true}"></textarea>
                    </div>
                </div>

            </fieldset>
            <div class="actions-toolbar">
                <div class="primary">
                    <input type="hidden" name="currUrl" id="currUrl" value="<?= $currPageUrl; ?>" />
                    <button type="submit" title="<?php /* @escapeNotVerified */ echo __('Submit') ?>" class="action submit primary">
                        <span><?php /* @escapeNotVerified */ echo __('Submit') ?></span>
                    </button>
                </div>
            </div>
        </form>
    </div>
    <?php } ?>
    <script type="text/javascript">
    require(
        [
        'jquery',
        'Lof_All/lib/fancybox/jquery.fancybox.pack',
        'mage/validation'
        ], function($){
        jQuery(document).ready(function($) {
            jQuery("#seller-contact").fancybox({
                'href'   : '#contact-seller',
                'titleShow'  : false,
                'transitionIn'  : 'elastic',
                'transitionOut' : 'elastic',
                'minWidth'        : 420,

            });
        });
    });
    </script>


<?php } ?>
<?php
if ($this->getSellerCollection() && count($this->checkVacation()->getData()) > 0) {
    $vacation = $this->getVacation()->getFirstItem(); ?>
    <script type="text/javascript">
    require(
        [
        'jquery'
        ], function($){
        $(document).ready(function($) {
            $('.box-tocart').html("<div class='fieldset'><button type='submit' title='<?= $vacation->getData('text_add_cart');?>' class='action primary tocart' id='product-addtocart-button' disabled=''><span><?= $vacation->getData('text_add_cart');?></span></button><div class='vacation_message'><?= $vacation->getData('vacation_message');?></div></div>");
        });
    });
    </script>

<?php } ?>
